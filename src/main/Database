
CREATE DATABASE student_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
use student_db;



-- BẢNG NGƯỜI DÙNG (Admin / Giáo viên / Sinh viên)
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(100) NOT NULL,
    full_name VARCHAR(100),
    email VARCHAR(100),
    phone VARCHAR(20), -- thêm phone
    role ENUM('ADMIN', 'TEACHER', 'STUDENT') NOT NULL,
    enabled BOOLEAN DEFAULT TRUE
);
-- BẢNG LỚP HỌC
CREATE TABLE classes (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT
);
-- GIÁO VIÊN PHỤ TRÁCH LỚP
CREATE TABLE teacher_class (
    teacher_id BIGINT,
    class_id BIGINT,
    PRIMARY KEY (teacher_id, class_id),
    FOREIGN KEY (teacher_id) REFERENCES users(id),
    FOREIGN KEY (class_id) REFERENCES classes(id)
);
-- SINH VIÊN TRONG LỚP
CREATE TABLE student_class (
    student_id BIGINT,
    class_id BIGINT,
    PRIMARY KEY (student_id, class_id),
    FOREIGN KEY (student_id) REFERENCES users(id),
    FOREIGN KEY (class_id) REFERENCES classes(id)
);
-- MÔN HỌC
CREATE TABLE subjects (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);

-- LỚP HỌC DẠY MÔN NÀO, DO AI GIẢNG DẠY
CREATE TABLE class_subject (
    class_id BIGINT,
    subject_id BIGINT,
    teacher_id BIGINT,
    PRIMARY KEY (class_id, subject_id),
    FOREIGN KEY (class_id) REFERENCES classes(id),
    FOREIGN KEY (subject_id) REFERENCES subjects(id),
    FOREIGN KEY (teacher_id) REFERENCES users(id)
);
-- BẢNG ĐIỂM
CREATE TABLE grades (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    student_id BIGINT,
    subject_id BIGINT,
    score FLOAT,
    FOREIGN KEY (student_id) REFERENCES users(id),
    FOREIGN KEY (subject_id) REFERENCES subjects(id)
);
-- THỜI KHÓA BIỂU (lịch học/lịch dạy)
CREATE TABLE timetables (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    class_id BIGINT NOT NULL,
    subject_id BIGINT NOT NULL,
    teacher_id BIGINT NOT NULL,
    room VARCHAR(50),                     -- Phòng học (A101, B203, v.v.)
    day_of_week ENUM('MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN') NOT NULL,
    start_time TIME NOT NULL,            -- Giờ bắt đầu
    end_time TIME NOT NULL,              -- Giờ kết thúc
    FOREIGN KEY (class_id) REFERENCES classes(id),
    FOREIGN KEY (subject_id) REFERENCES subjects(id),
    FOREIGN KEY (teacher_id) REFERENCES users(id)
);